2.2.0 :426 >   ObjectBasedAccessControl.disable
Disabled object based access control
 => true
2.2.0 :427 >     actor = ObjectBasedAccessControl.login_as('kobari+demo2@bbank.jp')
Disabled object based access control
delivery_setting).find_each.map { |u| [u.mail_addressable_type, u.hex_mail_addressable_id].join }
      all_of do
        without(:sourceable, sourceables)
      end
    end; nil
    p search.execute
    p search.instance_variable_get(:@solr_result)
    search.results.each do |ar|
      p ar.as_json
    endEnabled object based access control
 => #<Account uuid: "\xFD\xD0 \xB0AB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", encrypted_username: "orazfyiBEb8KOIDvB83v+OHxHJqOmSFr0TExCm0i2JE=\n", password_digest: "$2a$10$GZKLiUqHB38feLyHH5QveeZYOCscKjduyFbDlq48UQo...", lock_version: 37, created_at: 1439419168, updated_at: 1460443431, person_id: "\xFD\xAF\x80XAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", corporate_member_id: "\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", is_disabled: false, deleted_at: nil, created_by_id: nil, updated_by_id: "\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", country_id: 1, language_id: 73, is_restricted: false>
2.2.0 :428 >     # actor = ObjectBasedAccessControl.login_as('takenaka@bbank.jp')
2.2.0 :429 >       mail_delivery_setting = MailDeliverySetting.find_by_hex_id('9f1d9b989ca311e6b29d060fa9c2d21f')
 => #<BatchMailDeliverySetting uuid: "\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", lock_version: 26, created_at: 1477613724, created_by_id: "\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", updated_at: 1477617984, updated_by_id: "\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", deleted_at: nil, body_html: nil, body_text: nil, company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", encoding: 1, footer: "%FIRST_NAME%", header: "%FIRST_NAME%", mail_delivery_sender_id: "\x93\xC0J\x16\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", name: "フィルターテスト", parent_id: nil, priority: nil, schedule_at: nil, subject: nil, type: "BatchMailDeliverySetting", encrypted_reply_email: "T6WJVrGSphvZM5U7feoflg==\n", is_disabled: false, mail_delivery_base_date_type_id: nil, base_date_use_month_day: false, base_date_selectable_type: nil, base_date_selectable_id: nil, base_date_schedule_type: nil, base_date_before_or_after_number: nil, base_date_on_weekday: nil, base_date_on_day: nil, valid_term_is_enabled: false, valid_term_start_on: nil, valid_term_end_on: nil, dynamic_query: "{\"by\":\"and\",\"qs\":[[\"email\",\"n_inc\",\"kobari+\"]]}", step_order: nil, search_condition_id: nil>
2.2.0 :430 >     # mail_delivery_setting = MailDeliverySetting.find_by_hex_id('cef018a4578511e6803f0800275eaa7c')
2.2.0 :431 >
2.2.0 :432 >       p '---- unsubscriber list ----'
"---- unsubscriber list ----"
 => "---- unsubscriber list ----"
2.2.0 :433 >     MailDeliveryUnsubscriber.where(mail_delivery_setting: mail_delivery_setting).find_each do |unsubscriber|
2.2.0 :434 >           p unsubscriber.as_json
2.2.0 :435?>       end
{"uuid"=>"\x86\xCB\xDD\xC4\x9C\xA4\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614113, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614113, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"CorporateMember", "mail_addressable_id"=>"\xF5\xB0\e\x9A\x81\xCC\x11\xE5\x83s\x06\x8F<2W\x86", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x88\x9Ee\xB8\x9C\xA4\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614116, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614116, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Contact", "mail_addressable_id"=>"p\xBE\xEB\xBA\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x8C5\xAD\xEE\x9C\xA4\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614122, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614122, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Contact", "mail_addressable_id"=>"P\x9D5*\xFD#\x11\xE5\xAF\x7F\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x91\xBD\x05(\x9C\xA4\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614131, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614131, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"g\x12\x9B\xB4P\xEA\x11\xE5\xB2t\x06\x8F<2W\x86", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x94\n\x05j\x9C\xA4\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614135, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614135, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"\xAD\xD6O\x92O\xA8\x11\xE6\x99\x0F\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x95\xD3\xA7\xB6\x9C\xA4\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614138, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614138, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"\xA7\xD9!ZO\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x9D\x03Z|\x9C\xA4\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614150, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614150, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"CorporateMember", "mail_addressable_id"=>"\x90\twjY\xE3\x11\xE6\x9ER\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\x9F\xD3\xAB\xDA\x9C\xA4\x11\xE6\xA8K\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614155, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614155, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"CorporateMember", "mail_addressable_id"=>"\xDC\\\xE5\xC8nO\x11\xE5\xB43\x06\x8F<2W\x86", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xA1\xC8\xD0P\x9C\xA4\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614158, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614158, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"\xB8b\xAC\xD0W\x8C\x11\xE6\x91\xEA\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xA3\xF7\xB2\x92\x9C\xA4\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614162, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614162, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"CorporateMember", "mail_addressable_id"=>"\x9F\x95\x9C\xAAF\xFB\x11\xE5\xA2S\x06\x8F<2W\x86", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xA8\xAD\x9E\x00\x9C\xA4\x11\xE6\xA8K\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614169, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614169, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"CorporateMember", "mail_addressable_id"=>"#\xF2\xC0\xAAnQ\x11\xE5\xB5\x9E\x06\x8F<2W\x86", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xAAQb\x96\x9C\xA4\x11\xE6\xA8K\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614172, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614172, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"x\xA7\x12\xA8T\x7F\x11\xE6\xA1\xAB\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xAFu~B\x9C\xA4\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614181, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614181, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"\xFDo\xBF\xB6S\x9A\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xB28B\x9A\x9C\xA4\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614185, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614185, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"Fh\xAE\xDAS\x9B\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
{"uuid"=>"\xB3\xF4\x9A\x84\x9C\xA4\x11\xE6\xA8K\x06\x0F\xA9\xC2\xD2\x1F", "lock_version"=>0, "created_at"=>1477614188, "created_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "updated_at"=>1477614188, "updated_by_id"=>"\xFD\xB6a\xACAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "deleted_at"=>nil, "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "mail_delivery_setting_id"=>"\x9F\x1D\x9B\x98\x9C\xA3\x11\xE6\xB2\x9D\x06\x0F\xA9\xC2\xD2\x1F", "mail_addressable_type"=>"Person", "mail_addressable_id"=>"\x12\x87@ Ty\x11\xE6\xA6\x06\x06\x0F\xA9\xC2\xD2\x1F", "unsubscribe_type"=>"unsubscribe_by_form", "all_recipient_id"=>nil}
 => nil
2.2.0 :436 >
2.2.0 :437 >       p '---- allrecipient list ----'
"---- allrecipient list ----"
 => "---- allrecipient list ----"
2.2.0 :438 >     condition = {
2.2.0 :439 >           per_page: 100,
2.2.0 :440 >           dq: mail_delivery_setting.dynamic_query
2.2.0 :441?>       }
 => {:per_page=>100, :dq=>"{\"by\":\"and\",\"qs\":[[\"email\",\"n_inc\",\"kobari+\"]]}"}
2.2.0 :442 >     search = AllRecipientQuery.new(actor).engine_search(condition)
D, [2016-10-28T02:46:02.146219 #30913] DEBUG -- :   SOLR Request (3.2ms)  [ path=select parameters={fq: ["type:AllRecipient", "-email_s:*kobari+*", "company_id_s:fd2d25ea414211e5b5f2068f3c325786", "email_s:[* TO *]"], start: 0, rows: 100, q: "*:*"} ]
 => <Sunspot::Search:{:fq=>["type:AllRecipient", "-email_s:*kobari\\+*", "company_id_s:fd2d25ea414211e5b5f2068f3c325786", "email_s:[* TO *]"], :start=>0, :rows=>100, :q=>"*:*"}>
2.2.0 :443 >     search.build do
2.2.0 :444 >           # adjust_solr_params do |params|
2.2.0 :445 >           #   params['group'] = true
2.2.0 :446 >           #   params['group.field'] = 'sourceable_s'
2.2.0 :447 >           #   params['group.ngroups'] = true
2.2.0 :448 >           # end
2.2.0 :449 >           sourceables = MailDeliveryUnsubscriber.where(mail_delivery_setting: mail_delivery_setting).find_each.map { |u| [u.mail_addressable_type, u.hex_mail_addressable_id].join }
2.2.0 :450?>         all_of do
2.2.0 :451 >               without(:sourceable, sourceables)
2.2.0 :452?>           end
2.2.0 :453?>       end; nil
 => nil
2.2.0 :454 >     p search.execute
D, [2016-10-28T02:46:02.168924 #30913] DEBUG -- :   SOLR Request (3.5ms)  [ path=select parameters={fq: ["type:AllRecipient", "-email_s:*kobari+*", "company_id_s:fd2d25ea414211e5b5f2068f3c325786", "email_s:[* TO *]", "-sourceable_s:(CorporateMemberf5b01b9a81cc11e58373068f3c325786 OR Contact70beebbafd2211e591ec060fa9c2d21f OR Contact509d352afd2311e5af7f060fa9c2d21f OR Person67129bb450ea11e5b274068f3c325786 OR Personadd64f924fa811e6990f060fa9c2d21f OR Persona7d9215a4fa811e690c7060fa9c2d21f OR CorporateMember9009776a59e311e69e52060fa9c2d21f OR CorporateMemberdc5ce5c86e4f11e5b433068f3c325786 OR Personb862acd0578c11e691ea060fa9c2d21f OR CorporateMember9f959caa46fb11e5a253068f3c325786 OR CorporateMember23f2c0aa6e5111e5b59e068f3c325786 OR Person78a712a8547f11e6a1ab060fa9c2d21f OR Personfd6fbfb6539a11e6b8cd060fa9c2d21f OR Person4668aeda539b11e6b8cd060fa9c2d21f OR Person12874020547911e6a606060fa9c2d21f)"], start: 0, rows: 100, q: "*:*"} ]
<Sunspot::Search:{:fq=>["type:AllRecipient", "-email_s:*kobari\\+*", "company_id_s:fd2d25ea414211e5b5f2068f3c325786", "email_s:[* TO *]", "-sourceable_s:(CorporateMemberf5b01b9a81cc11e58373068f3c325786 OR Contact70beebbafd2211e591ec060fa9c2d21f OR Contact509d352afd2311e5af7f060fa9c2d21f OR Person67129bb450ea11e5b274068f3c325786 OR Personadd64f924fa811e6990f060fa9c2d21f OR Persona7d9215a4fa811e690c7060fa9c2d21f OR CorporateMember9009776a59e311e69e52060fa9c2d21f OR CorporateMemberdc5ce5c86e4f11e5b433068f3c325786 OR Personb862acd0578c11e691ea060fa9c2d21f OR CorporateMember9f959caa46fb11e5a253068f3c325786 OR CorporateMember23f2c0aa6e5111e5b59e068f3c325786 OR Person78a712a8547f11e6a1ab060fa9c2d21f OR Personfd6fbfb6539a11e6b8cd060fa9c2d21f OR Person4668aeda539b11e6b8cd060fa9c2d21f OR Person12874020547911e6a606060fa9c2d21f)"], :start=>0, :rows=>100, :q=>"*:*"}>
 => <Sunspot::Search:{:fq=>["type:AllRecipient", "-email_s:*kobari\\+*", "company_id_s:fd2d25ea414211e5b5f2068f3c325786", "email_s:[* TO *]", "-sourceable_s:(CorporateMemberf5b01b9a81cc11e58373068f3c325786 OR Contact70beebbafd2211e591ec060fa9c2d21f OR Contact509d352afd2311e5af7f060fa9c2d21f OR Person67129bb450ea11e5b274068f3c325786 OR Personadd64f924fa811e6990f060fa9c2d21f OR Persona7d9215a4fa811e690c7060fa9c2d21f OR CorporateMember9009776a59e311e69e52060fa9c2d21f OR CorporateMemberdc5ce5c86e4f11e5b433068f3c325786 OR Personb862acd0578c11e691ea060fa9c2d21f OR CorporateMember9f959caa46fb11e5a253068f3c325786 OR CorporateMember23f2c0aa6e5111e5b59e068f3c325786 OR Person78a712a8547f11e6a1ab060fa9c2d21f OR Personfd6fbfb6539a11e6b8cd060fa9c2d21f OR Person4668aeda539b11e6b8cd060fa9c2d21f OR Person12874020547911e6a606060fa9c2d21f)"], :start=>0, :rows=>100, :q=>"*:*"}>
2.2.0 :455 >     p search.instance_variable_get(:@solr_result)
{"responseHeader"=>{"status"=>0, "QTime"=>1}, "response"=>{"numFound"=>9, "start"=>0, "docs"=>[{"id"=>"AllRecipient 64dbb1ac53a811e6b8cd060fa9c2d21f", "_version_"=>"1541626402641543168"}, {"id"=>"AllRecipient da81c09e4fa811e690c7060fa9c2d21f", "_version_"=>"1542985428728020992"}, {"id"=>"AllRecipient dfca602e4fa811e690c7060fa9c2d21f", "_version_"=>"1542985430448734208"}, {"id"=>"AllRecipient 977821ce480c11e6afe3060fa9c2d21f", "_version_"=>"1542985387315560448"}, {"id"=>"AllRecipient 98567848480c11e6afe3060fa9c2d21f", "_version_"=>"1542985389431586816"}, {"id"=>"AllRecipient 91d20f32480c11e6afe3060fa9c2d21f", "_version_"=>"1542985374578507776"}, {"id"=>"AllRecipient 9aa5d4e0480c11e6afe3060fa9c2d21f", "_version_"=>"1542985393567170560"}, {"id"=>"AllRecipient 9aac7f7a480c11e6afe3060fa9c2d21f", "_version_"=>"1542985393623793664"}, {"id"=>"AllRecipient 913fddc09ca211e6af6c060fa9c2d21f", "_version_"=>"1549392117214740480"}]}}
 => {"responseHeader"=>{"status"=>0, "QTime"=>1}, "response"=>{"numFound"=>9, "start"=>0, "docs"=>[{"id"=>"AllRecipient 64dbb1ac53a811e6b8cd060fa9c2d21f", "_version_"=>"1541626402641543168"}, {"id"=>"AllRecipient da81c09e4fa811e690c7060fa9c2d21f", "_version_"=>"1542985428728020992"}, {"id"=>"AllRecipient dfca602e4fa811e690c7060fa9c2d21f", "_version_"=>"1542985430448734208"}, {"id"=>"AllRecipient 977821ce480c11e6afe3060fa9c2d21f", "_version_"=>"1542985387315560448"}, {"id"=>"AllRecipient 98567848480c11e6afe3060fa9c2d21f", "_version_"=>"1542985389431586816"}, {"id"=>"AllRecipient 91d20f32480c11e6afe3060fa9c2d21f", "_version_"=>"1542985374578507776"}, {"id"=>"AllRecipient 9aa5d4e0480c11e6afe3060fa9c2d21f", "_version_"=>"1542985393567170560"}, {"id"=>"AllRecipient 9aac7f7a480c11e6afe3060fa9c2d21f", "_version_"=>"1542985393623793664"}, {"id"=>"AllRecipient 913fddc09ca211e6af6c060fa9c2d21f", "_version_"=>"1549392117214740480"}]}}
2.2.0 :456 >     search.results.each do |ar|
2.2.0 :457 >           p ar.as_json
2.2.0 :458?>       end
{"uuid"=>"d\xDB\xB1\xACS\xA8\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"\xFDo\xBF\xB6S\x9A\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"d\xC8B4S\xA8\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"Customer", "lock_version"=>11, "created_at"=>1469589339, "updated_at"=>1469697303, "deleted_at"=>nil}
{"uuid"=>"\xDA\x81\xC0\x9EO\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"\xA7\xD9!ZO\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"\xDAh\xDA\xE8O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"Customer", "lock_version"=>1, "created_at"=>1469149732, "updated_at"=>1471505573, "deleted_at"=>nil}
{"uuid"=>"\xDF\xCA`.O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"\xAD\xD6O\x92O\xA8\x11\xE6\x99\x0F\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"\xDF\xB7\xD6\x16O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"Customer", "lock_version"=>1, "created_at"=>1469149740, "updated_at"=>1471505575, "deleted_at"=>nil}
{"uuid"=>"\x97x!\xCEH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"c\xB5\xBA\fF\xFC\x11\xE5\x91\xDF\x06\x8F<2W\x86", "sourceable_id"=>"?{\xD7<B\xF8\x11\xE5\xBD\xFC\x06\x8F<2W\x86", "sourceable_type"=>"CustomerRevision", "lock_version"=>3, "created_at"=>1468312959, "updated_at"=>1471505534, "deleted_at"=>nil}
{"uuid"=>"\x98VxHH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"g\x12\x9B\xB4P\xEA\x11\xE5\xB2t\x06\x8F<2W\x86", "sourceable_id"=>"g\x13\xF9nP\xEA\x11\xE5\xB2t\x06\x8F<2W\x86", "sourceable_type"=>"Customer", "lock_version"=>3, "created_at"=>1468312961, "updated_at"=>1471505536, "deleted_at"=>nil}
{"uuid"=>"\x91\xD2\x0F2H\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"P\x99B\x94\xFD#\x11\xE5\xAF\x7F\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"P|^r\xFD#\x11\xE5\xAF\x7F\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"CustomerRevision", "lock_version"=>3, "created_at"=>1468312950, "updated_at"=>1471505522, "deleted_at"=>nil}
{"uuid"=>"\x9A\xA5\xD4\xE0H\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"p\xB9Q\xA0\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"B\x16\xF7\xFC\xFD#\x11\xE5\x93\xAB\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"CustomerRevision", "lock_version"=>3, "created_at"=>1468312965, "updated_at"=>1471505540, "deleted_at"=>nil}
{"uuid"=>"\x9A\xAC\x7FzH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"p\xB9Q\xA0\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"p\x89=\b\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"CustomerRevision", "lock_version"=>3, "created_at"=>1468312965, "updated_at"=>1471505540, "deleted_at"=>nil}
{"uuid"=>"\x91?\xDD\xC0\x9C\xA2\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "company_id"=>"\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", "person_id"=>"\x91\x1E\xB3H\x9C\xA2\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_id"=>"\xE9\xA7g\xAA\x9C\xA0\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", "sourceable_type"=>"CompanyRevision", "lock_version"=>3, "created_at"=>1477613271, "updated_at"=>1477615466, "deleted_at"=>nil}
 => [#<AllRecipient uuid: "d\xDB\xB1\xACS\xA8\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "\xFDo\xBF\xB6S\x9A\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "d\xC8B4S\xA8\x11\xE6\xB8\xCD\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "Customer", lock_version: 11, created_at: 1469589339, updated_at: 1469697303, deleted_at: nil>, #<AllRecipient uuid: "\xDA\x81\xC0\x9EO\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "\xA7\xD9!ZO\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "\xDAh\xDA\xE8O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "Customer", lock_version: 1, created_at: 1469149732, updated_at: 1471505573, deleted_at: nil>, #<AllRecipient uuid: "\xDF\xCA`.O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "\xAD\xD6O\x92O\xA8\x11\xE6\x99\x0F\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "\xDF\xB7\xD6\x16O\xA8\x11\xE6\x90\xC7\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "Customer", lock_version: 1, created_at: 1469149740, updated_at: 1471505575, deleted_at: nil>, #<AllRecipient uuid: "\x97x!\xCEH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "c\xB5\xBA\fF\xFC\x11\xE5\x91\xDF\x06\x8F<2W\x86", sourceable_id: "?{\xD7<B\xF8\x11\xE5\xBD\xFC\x06\x8F<2W\x86", sourceable_type: "CustomerRevision", lock_version: 3, created_at: 1468312959, updated_at: 1471505534, deleted_at: nil>, #<AllRecipient uuid: "\x98VxHH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "g\x12\x9B\xB4P\xEA\x11\xE5\xB2t\x06\x8F<2W\x86", sourceable_id: "g\x13\xF9nP\xEA\x11\xE5\xB2t\x06\x8F<2W\x86", sourceable_type: "Customer", lock_version: 3, created_at: 1468312961, updated_at: 1471505536, deleted_at: nil>, #<AllRecipient uuid: "\x91\xD2\x0F2H\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "P\x99B\x94\xFD#\x11\xE5\xAF\x7F\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "P|^r\xFD#\x11\xE5\xAF\x7F\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "CustomerRevision", lock_version: 3, created_at: 1468312950, updated_at: 1471505522, deleted_at: nil>, #<AllRecipient uuid: "\x9A\xA5\xD4\xE0H\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "p\xB9Q\xA0\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "B\x16\xF7\xFC\xFD#\x11\xE5\x93\xAB\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "CustomerRevision", lock_version: 3, created_at: 1468312965, updated_at: 1471505540, deleted_at: nil>, #<AllRecipient uuid: "\x9A\xAC\x7FzH\f\x11\xE6\xAF\xE3\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "p\xB9Q\xA0\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "p\x89=\b\xFD\"\x11\xE5\x91\xEC\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "CustomerRevision", lock_version: 3, created_at: 1468312965, updated_at: 1471505540, deleted_at: nil>, #<AllRecipient uuid: "\x91?\xDD\xC0\x9C\xA2\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", company_id: "\xFD-%\xEAAB\x11\xE5\xB5\xF2\x06\x8F<2W\x86", person_id: "\x91\x1E\xB3H\x9C\xA2\x11\xE6\xAFl\x06\x0F\xA9\xC2\xD2\x1F", sourceable_id: "\xE9\xA7g\xAA\x9C\xA0\x11\xE6\xA7\xAB\x06\x0F\xA9\xC2\xD2\x1F", sourceable_type: "CompanyRevision", lock_version: 3, created_at: 1477613271, updated_at: 1477615466, deleted_at: nil>]
2.2.0 :459 >
